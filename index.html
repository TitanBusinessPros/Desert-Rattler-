<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Desert Rattler Snake Game</title>
    <link rel="icon" type="image/png" href="https://github.com/TitanBusinessPros/Desert-Rattler-/raw/main/Desert%20Rattler%20Favicon.png">
    <style>
        * {
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            font-family: sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #e6b87a 0%, #d89a3e 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
       
        .cactus-emoji {
            position: absolute;
            z-index: -1;
            pointer-events: none;
        }
        #cactus-large {
            bottom: 60px;
            left: 5%;
            font-size: 120px;
            opacity: 0.8;
        }
        #cactus-small {
            top: 20%;
            right: 10%;
            font-size: 70px;
            opacity: 0.6;
        }
        #cactus-medium1 {
            bottom: 30%;
            left: 15%;
            font-size: 90px;
            opacity: 0.7;
        }
        #cactus-medium2 {
            top: 10%;
            left: 5%;
            font-size: 80px;
            opacity: 0.6;
        }
        #cactus-medium3 {
            bottom: 15%;
            right: 15%;
            font-size: 100px;
            opacity: 0.7;
        }

        #gameLogo {
            max-width: 90%;
            max-height: 80px;
            margin-bottom: 5px;
        }

        canvas {
            background-color: #fff;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 90vw;
            max-width: 450px;
            height: 90vw;
            max-height: 450px;
            margin: 10px 0;
        }
        
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
            max-width: 450px;
            margin-top: 10px;
        }
       
        #gameControlsRow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .scoreDisplay {
            font-size: 1em;
            font-weight: bold;
            flex: 1;
            padding: 0 5px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            margin: 0 5px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-btn-action {
            background-color: #4FC3F7;
            padding: 10px 15px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            width: 100px;
            margin: 0 5px;
        }
        .game-btn-action:hover {
            background-color: #00B0FF;
        }
        
        .mute-btn {
            background-color: #FF9800;
            padding: 10px 15px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            width: 80px;
            margin-left: 10px;
        }
        .mute-btn:hover {
            background-color: #F57C00;
        }

        .controls-row {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 5px;
        }
        .control-btn {
            background-color: #66BB6A;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
            touch-action: manipulation;
            width: 50px;
            height: 50px;
            margin: 2px;
            font-size: 0.9em;
        }
        .control-btn:hover {
            background-color: #4CAF50;
        }
        .spacer {
            width: 50px;
            height: 50px;
            margin: 2px;
        }
        
        /* Tumbleweed background animation */
        .tumbleweed-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        
        .tumbleweed {
            position: absolute;
            font-size: 30px;
            opacity: 0.3;
            animation: tumble 20s linear infinite;
        }
        
        @keyframes tumble {
            0% { 
                transform: translateX(-50px) rotate(0deg); 
            }
            100% { 
                transform: translateX(calc(100vw + 50px)) rotate(360deg); 
            }
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        /* Stage selection */
        #stageSelection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
            gap: 8px;
            width: 100%;
        }
        
        .stage-btn {
            background-color: #8D6E63;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.8em;
            flex: 1;
            min-width: 70px;
            max-width: 100px;
        }
        
        .stage-btn.active {
            background-color: #5D4037;
            box-shadow: 0 0 5px #FFD700;
        }
        
        .stage-btn:hover {
            background-color: #6D4C41;
        }
        
        /* Mobile-specific adjustments */
        @media (max-width: 480px) {
            .game-btn-action, .mute-btn {
                padding: 12px 10px;
                font-size: 0.8em;
                margin: 2px;
            }
            
            .scoreDisplay {
                font-size: 0.9em;
                padding: 5px;
            }
            
            #gameControlsRow {
                flex-wrap: wrap;
            }
            
            .stage-btn {
                padding: 10px 5px;
                font-size: 0.7em;
            }
        }
        
        /* Snake sprite styling */
        .snake-sprite {
            display: none;
        }
    </style>
</head>
<body>
    <div class="tumbleweed-bg" id="tumbleweedBg"></div>
    
    <span id="cactus-large" class="cactus-emoji">ðŸŒµ</span>
    <span id="cactus-small" class="cactus-emoji">ðŸŒµ</span>
    <span id="cactus-medium1" class="cactus-emoji">ðŸŒµ</span>
    <span id="cactus-medium2" class="cactus-emoji">ðŸŒµ</span>
    <span id="cactus-medium3" class="cactus-emoji">ðŸŒµ</span>
    
    <img id="gameLogo" src="https://github.com/TitanBusinessPros/Desert-Rattler-/raw/main/Desert%20Rattler%20Logo.png" alt="Desert Rattler Logo">
   
    <div id="stageSelection">
        <button class="stage-btn active" onclick="changeStage(0)">Sandy Dunes</button>
        <button class="stage-btn" onclick="changeStage(1)">Red Canyon</button>
        <button class="stage-btn" onclick="changeStage(2)">Oasis</button>
        <button class="stage-btn" onclick="changeStage(3)">Mesa</button>
        <button class="stage-btn" onclick="changeStage(4)">Night Desert</button>
    </div>
    
    <canvas id="gameCanvas" width="450" height="450"></canvas>
   
    <div id="controls">
        <div id="gameControlsRow">
            <div id="currentScoreDisplay" class="scoreDisplay">Score: 0</div>
            <div id="highScoreDisplay" class="scoreDisplay">High Score: 0</div>
        </div>
        
        <div class="button-container">
            <button id="startButton" class="game-btn-action" onclick="startGame()">Start Game</button>
            <button id="restartButton" class="game-btn-action" onclick="restartGame()" style="display: none;">Restart Game</button>
            <button id="muteButton" class="mute-btn" onclick="toggleMute()">Mute</button>
        </div>
       
        <div class="controls-row">
            <div class="spacer"></div>
            <button class="control-btn" ontouchstart="setDirection(38)" onclick="setDirection(38)">Up</button>
            <div class="spacer"></div>
        </div>
        <div class="controls-row">
            <button class="control-btn" ontouchstart="setDirection(37)" onclick="setDirection(37)">Left</button>
            <button class="control-btn" ontouchstart="setDirection(39)" onclick="setDirection(39)">Right</button>
        </div>
        <div class="controls-row">
            <div class="spacer"></div>
            <button class="control-btn" ontouchstart="setDirection(40)" onclick="setDirection(40)">Down</button>
            <div class="spacer"></div>
        </div>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="https://github.com/TitanBusinessPros/Desert-Rattler-/raw/main/Desert%20Rattler%20Theme%20Song.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Preload snake sprite -->
    <img id="snakeSprite" class="snake-sprite" src="https://github.com/TitanBusinessPros/Desert-Rattler-/raw/main/Desert%20Rattler%20Favicon.png" alt="Snake Sprite">

    <script>
        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 15;
        const gameSpeed = 150;
        const MAX_FRUITS = 5;
        let snake = [];
        let fruits = [];
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = 0;
        let gameInterval;
        let changingDirection = false;
        let gameRunning = false;
        let isMuted = false;
        const backgroundMusic = document.getElementById('backgroundMusic');
        const snakeSprite = document.getElementById('snakeSprite');
        
        // Stage configurations
        const stages = [
            {
                name: "Sandy Dunes",
                background: "linear-gradient(135deg, #e6b87a 0%, #d89a3e 100%)",
                groundColor: "#f5d7a1",
                fruitColors: ['#FF6347', '#4682B4', '#32CD32', '#FFD700', '#9370DB']
            },
            {
                name: "Red Canyon",
                background: "linear-gradient(135deg, #c1440e 0%, #8b3101 100%)",
                groundColor: "#d15e27",
                fruitColors: ['#FF8C00', '#FF4500', '#DC143C', '#B22222', '#8B0000']
            },
            {
                name: "Oasis",
                background: "linear-gradient(135deg, #87CEEB 0%, #20B2AA 100%)",
                groundColor: "#98FB98",
                fruitColors: ['#32CD32', '#00FA9A', '#00FF7F', '#3CB371', '#2E8B57']
            },
            {
                name: "Mesa",
                background: "linear-gradient(135deg, #CD853F 0%, #8B4513 100%)",
                groundColor: "#DEB887",
                fruitColors: ['#D2691E', '#A0522D', '#8B4513', '#CD853F', '#D2B48C']
            },
            {
                name: "Night Desert",
                background: "linear-gradient(135deg, #2c3e50 0%, #34495e 100%)",
                groundColor: "#4a6572",
                fruitColors: ['#FFD700', '#FFA500', '#FF8C00', '#FF6347', '#9370DB']
            }
        ];
        
        let currentStage = 0;
        let ateFruit = false; // Track if we ate a fruit in the current move

        // Create background tumbleweeds
        function createBackgroundTumbleweeds() {
            const tumbleweedBg = document.getElementById('tumbleweedBg');
            tumbleweedBg.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const tumbleweed = document.createElement('div');
                tumbleweed.className = 'tumbleweed';
                tumbleweed.innerHTML = 'ðŸŒµ';
                tumbleweed.style.top = `${Math.random() * 100}%`;
                tumbleweed.style.animationDelay = `${Math.random() * 20}s`;
                tumbleweedBg.appendChild(tumbleweed);
            }
        }

        // Change stage function
        function changeStage(stageIndex) {
            currentStage = stageIndex;
            const stageButtons = document.querySelectorAll('.stage-btn');
            stageButtons.forEach((btn, index) => {
                if (index === stageIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Update background
            document.body.style.background = stages[stageIndex].background;
            
            // Update canvas background color
            canvas.style.backgroundColor = stages[stageIndex].groundColor;
            
            // Redraw the game with new stage settings
            if (!gameRunning) {
                draw();
            }
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }

        // Initialize game state and load high score
        function initializeGame() {
            snake = [{ x: 15, y: 15 }];
            dx = 0;
            dy = 0;
            score = 0;
            fruits = [];
            ateFruit = false;
            document.getElementById('currentScoreDisplay').innerText = 'Score: 0';
            highScore = localStorage.getItem('snakeHighScore') || 0;
            document.getElementById('highScoreDisplay').innerText = 'High Score: ' + highScore;
            for (let i = 0; i < 3; i++) {
                generateFruit();
            }
            draw();
            
            // Reset button states
            document.getElementById('startButton').style.display = 'inline-block';
            document.getElementById('restartButton').style.display = 'none';
        }

        function generateFruit() {
            const minSize = 8;
            const randomSize = Math.floor(Math.random() * (gridSize - minSize + 1)) + minSize;
            const newFruit = {
                x: Math.floor(Math.random() * (canvas.width / gridSize)),
                y: Math.floor(Math.random() * (canvas.height / gridSize)),
                color: stages[currentStage].fruitColors[Math.floor(Math.random() * stages[currentStage].fruitColors.length)],
                size: randomSize
            };
            
            // Make sure fruit doesn't spawn on snake
            let onSnake = false;
            for (let segment of snake) {
                if (segment.x === newFruit.x && segment.y === newFruit.y) {
                    onSnake = true;
                    break;
                }
            }
            
            if (!onSnake) {
                fruits.push(newFruit);
            } else {
                // Try again if fruit would spawn on snake
                generateFruit();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw snake with custom sprite for head and body segments
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // Draw head with custom sprite
                    ctx.drawImage(snakeSprite, segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
                } else {
                    // Draw body segments with color based on stage
                    ctx.fillStyle = getSnakeBodyColor();
                    roundRect(ctx, segment.x * gridSize + 1, segment.y * gridSize + 1, gridSize - 2, gridSize - 2, 4);
                }
            });
           
            // Draw fruits
            fruits.forEach(fruit => {
                ctx.fillStyle = fruit.color;
                const offset = (gridSize - fruit.size) / 2;
                ctx.fillRect(fruit.x * gridSize + offset, fruit.y * gridSize + offset, fruit.size, fruit.size);
            });
        }
        
        function getSnakeBodyColor() {
            // Return different colors based on stage for variety
            const stageColors = ['#6E9A3C', '#8B4513', '#2E8B57', '#CD853F', '#4a6572'];
            return stageColors[currentStage];
        }

        // Move the snake and check for collisions
        function moveSnake() {
            const head = snake[0];
            const headX = head.x + dx;
            const headY = head.y + dy;
            const newHead = { x: headX, y: headY };
            snake.unshift(newHead);
            changingDirection = false;

            ateFruit = false;
            for (let i = 0; i < fruits.length; i++) {
                if (newHead.x === fruits[i].x && newHead.y === fruits[i].y) {
                    ateFruit = true;
                    score++;
                    document.getElementById('currentScoreDisplay').innerText = 'Score: ' + score;
                    fruits.splice(i, 1);
                    if (fruits.length < MAX_FRUITS) {
                        generateFruit();
                    }
                    break;
                }
            }

            // Only remove the tail if we didn't eat a fruit
            if (!ateFruit) {
                snake.pop();
            }
        }

        // Check for game over
        function checkGameOver() {
            const head = snake[0];
            
            // Check wall collision
            if (head.x < 0 || head.x >= canvas.width / gridSize || head.y < 0 || head.y >= canvas.height / gridSize) {
                return true;
            }
            
            // Check self collision (skip the head)
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    return true;
                }
            }
            
            return false;
        }

        // Main game loop
        function gameLoop() {
            if (checkGameOver()) {
                clearInterval(gameInterval);
                gameRunning = false;
               
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    document.getElementById('highScoreDisplay').innerText = 'High Score: ' + highScore;
                    alert(`New High Score! Score: ${score}`);
                } else {
                    alert(`Game Over! Score: ${score}`);
                }
               
                document.getElementById('startButton').style.display = 'none';
                document.getElementById('restartButton').style.display = 'inline-block';
                return;
            }
            
            moveSnake();
            draw();
        }

        // Start button handler
        function startGame() {
            if (gameRunning) return;
            gameRunning = true;
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('restartButton').style.display = 'inline-block';
            dx = 1;
            dy = 0;
            gameInterval = setInterval(gameLoop, gameSpeed);
            
            // Start background music when game starts
            if (!isMuted) {
                backgroundMusic.play().catch(error => {
                    console.log("Audio play failed:", error);
                });
            }
        }

        // Restart button handler
        function restartGame() {
            clearInterval(gameInterval);
            gameRunning = false;
            initializeGame();
        }

        // Toggle mute function
        function toggleMute() {
            isMuted = !isMuted;
            backgroundMusic.muted = isMuted;
            document.getElementById('muteButton').innerText = isMuted ? 'Unmute' : 'Mute';
        }

        // Set direction (Keyboard and D-pad)
        function setDirection(keyCode) {
            if (!gameRunning || changingDirection) return;
            changingDirection = true;
           
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingRight = dx === 1;
            const goingLeft = dx === -1;

            if (keyCode === 37 && !goingRight) { dx = -1; dy = 0; }
            if (keyCode === 38 && !goingDown) { dx = 0; dy = -1; }
            if (keyCode === 39 && !goingLeft) { dx = 1; dy = 0; }
            if (keyCode === 40 && !goingUp) { dx = 0; dy = 1; }
        }

        // Touch controls for mobile
        let touchStartX = 0;
        let touchStartY = 0;
        
        canvas.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        }, false);
        
        canvas.addEventListener('touchmove', function(e) {
            if (!gameRunning) return;
            
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const dxTouch = touchX - touchStartX;
            const dyTouch = touchY - touchStartY;
            
            if (Math.abs(dxTouch) > Math.abs(dyTouch)) {
                // Horizontal swipe
                if (dxTouch > 0) {
                    setDirection(39); // Right
                } else {
                    setDirection(37); // Left
                }
            } else {
                // Vertical swipe
                if (dyTouch > 0) {
                    setDirection(40); // Down
                } else {
                    setDirection(38); // Up
                }
            }
            
            touchStartX = touchX;
            touchStartY = touchY;
            e.preventDefault();
        }, false);

        // Keyboard event listener
        document.addEventListener('keydown', (event) => {
            if ((event.keyCode >= 37 && event.keyCode <= 40) || event.keyCode === 32) {
                event.preventDefault();
            }
            if (event.keyCode === 32 && !gameRunning) {
                startGame();
            } else {
                setDirection(event.keyCode);
            }
        });

        // Initialize on load
        window.onload = function() {
            initializeGame();
            createBackgroundTumbleweeds();
            
            // Ensure the snake sprite is loaded before starting
            snakeSprite.onload = function() {
                draw();
            };
            
            // Fallback in case sprite fails to load
            snakeSprite.onerror = function() {
                console.log("Snake sprite failed to load, using default graphics");
                draw();
            };
        };
    </script>
</body>
</html>
